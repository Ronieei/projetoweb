<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/fragments/layout :: layout(~{::head}, ~{::main})}">

<head th:replace="~{fragments/head :: head(~{::title},~{})}">
    <title th:fragment="title">Lista de Horários Disponíveis</title>
</head>

<main>
    <div class="container my-4">
        <div class="d-flex justify-content-between align-items-end mb-3">
            <form th:action="@{/consulta/pesquisar}" method="get" class="row g-2 w-100 align-items-end">
                <div th:if="${mensagemErro}" class="alert alert-warning alert-dismissible fade show" role="alert">
                    <span th:text="${mensagemErro}"></span>
                </div>
                <div th:if="${mensagemSucesso}" class="alert alert-success alert-dismissible fade show" role="alert">
                    <span th:text="${mensagemSucesso}"></span>
                </div>

                <!-- Data da consulta -->
                <div class="col-md-2">
                    <label for="dataInicial" class="form-label small mb-1">Data inicial</label>
                    <input type="date" class="form-control form-control-sm"
                           id="dataInicial" name="dataInicial" th:value="${dataInicial}"/>
                </div>

                <div class="col-md-2">
                    <label for="dataFinal" class="form-label small mb-1">Data final</label>
                    <input type="date" class="form-control form-control-sm"
                           id="dataFinal" name="dataFinal" th:value="${dataFinal}"/>
                </div>

                <!-- Horário de Início -->
                <div class="col-md-1">
                    <label for="horarioInicio" class="form-label small mb-1">Horário Início</label>
                    <input type="time" class="form-control form-control-sm" id="horarioInicio" name="horarioInicio"
                           th:value="${horarioInicio}"/>
                </div>

                <!-- Horário de Término -->
                <div class="col-md-1">
                    <label for="horarioFim" class="form-label small mb-1">Horário Fim</label>
                    <input type="time" class="form-control form-control-sm" id="horarioFim" name="horarioFim"
                           th:value="${horarioFim}"/>
                </div>

                <!-- Médico -->
                <div class="col-md-2">
                    <select class="form-select-sm" id="medicoId" name="medicoId">
                        <option value="">Todos Médicos</option>
                        <option th:each="m : ${medicos}"
                                th:value="${m.id}"
                                th:text="${m.nome}"
                                th:selected="${medicoSelecionado} == ${m.id}">
                        </option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label for="statusSelecionado" class="form-label small mb-1">Status</label>
                    <select class="form-select form-select-sm" id="statusSelecionado" name="statusSelecionado">
                        <option value="">Todos Status</option>
                        <option th:each="status : ${statusConsultaList}"
                                th:value="${status.name()}"
                                th:text="${status.name()}"
                                th:selected="${statusSelecionado != null} ? ${status.name()} == ${statusSelecionado.name()} : false">
                        </option>
                    </select>
                </div>

                <!-- Botão de pesquisa -->
                <div class="col-md-1 text-end">
                    <button type="submit" class="btn btn-primary btn-sm w-100">Pesquisar</button>
                </div>
            </form>
        </div>

        <!-- Tabela de consultas agendadas -->
        <h4 class="mt-4">Consultas Agendadas</h4>
        <table class="table table-bordered table-striped">
            <thead>
            <tr>
                <th>ID</th>
                <th>Data</th>
                <th>Início</th>
                <th>Término</th>
                <th>Observação</th>
                <th>Paciente</th>
                <th>Médico</th>
                <th class="text-center">Status</th>
                <th class="text-center">Ações</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="c : ${consultas}">
                <td th:text="${c.id}"></td>
                <td th:text="${#temporals.format(c.data, 'dd/MM/yyyy')}"></td>
                <td th:text="${#temporals.format(c.horarioInicio, 'HH:mm')}"></td>
                <td th:text="${#temporals.format(c.horarioFim, 'HH:mm')}"></td>
                <td th:text="${c.observacao != null and !c.observacao.isBlank()} ? ${c.observacao} : 'Sem Observação'"></td>
                <td th:text="${c.paciente != null ? c.paciente.nome : 'Sem Paciente'}"></td>
                <td th:text="${c.medico.nome}"></td>
                <td class="text-center" th:text="${c.status}"></td>
                <td class="text-center">
                    <a class="btn btn-sm btn-warning" th:href="@{/consulta/edit/{id}(id=${c.id})}">Editar</a>
                    <a class="btn btn-sm btn-danger" th:href="@{/consulta/remove/{id}(id=${c.id})}"
                       onclick="return confirm('Deseja realmente excluir?')">Excluir</a>
                    <a th:if="${c.status == status_Consulta}"
                       class="btn btn-sm btn-primary" th:href="@{/consulta/cancelar/{id}(id=${c.id})}">Cancelar</a>
                    <a th:if="${c.status == status_Consulta}"
                       class="btn btn-sm btn-success" th:href="@{/consulta/concluir/{id}(id=${c.id})}">Concluida</a>
                </td>
            </tr>
            <tr th:if="${#lists.isEmpty(consultas)}">
                <td colspan="9" class="text-center">Nenhuma consulta encontrada.</td>
            </tr>
            </tbody>
        </table>
    </div>
</main>
</html>